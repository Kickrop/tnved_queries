--расчеты рыбы и бункера за 2019 год (рыба только по экспорту)
--
select * from export_fish_2019
--ex fish 19
create materialized view stat_customs.export19_fish_minus as
select a.country,summa,total,total-summa minus,max_gr from 
(select 
	﻿year,country
	--, sum(st_rub::numeric)
	, sum(st_doll_mln::numeric) summa
	, max(st_doll_mln::numeric) max_gr
from export_fish_2019
where 
	code_name <> '00 - всего по товарам' 
group by ﻿year,country) a
join
(select 
	﻿year,country
	--, sum(st_rub::numeric)
	, sum(st_doll_mln::numeric) total
from export_fish_2019
where 
	code_name = '00 - всего по товарам' 
group by ﻿year,country) b
on a.country=b.country
order by minus desc
--
--ex fish 19
drop materialized view stat_customs._1_export19_fish_added_sum cascade
create materialized view stat_customs._1_export19_fish_added_sum as
select '2019' as year,a.country, code_6--,summa,minus,max_sum,max_gr
	,case when max_sum=max_gr then summa+minus else summa end as added_sum
from 
(select 
	country
	, code_6
	, sum(st_doll_mln::numeric) summa
	, max(st_doll_mln::numeric) max_sum
from export_fish_2019
where 	
	code_name <> '00 - всего по товарам' 
group by ﻿year,country,code_6) a
join
(select 
	country
	, minus
	, max_gr
from export19_fish_minus
) b
on a.country=b.country
order by country

--
create materialized view stat_customs.import19_bunc_minus as
select a.country,summa,total,total-summa minus,max_gr from 
(select 
	country
	--, sum(st_rub::numeric)
	, sum(st_doll_mln::numeric) summa
	, max(st_doll_mln::numeric) max_gr
from import_bunk_2019
where 
	code_name <> 'Итого'
group by country) a
join
(select 
	country
	--, sum(st_rub::numeric)
	, sum(st_doll_mln::numeric) total
from import_bunk_2019
where 
	code_name = 'Итого'
group by country) b
on a.country=b.country
order by minus desc
---

drop materialized view stat_customs._1_import19_bunc_added_sum cascade
create materialized view stat_customs._1_import19_bunc_added_sum as
select 
	'2019' as year
	,a.country
	,code_6  as tnved
	,case when max_sum=max_gr then summa+minus else summa end as added_sum
from 
	(select 
		country
		, code_6 
		, sum(st_doll_mln::numeric) summa
		, max(st_doll_mln::numeric) max_sum
	from 
		import_bunk_2019
	where 
		code_name <> 'Итого'
	group by 
		country,code_6) a
	join
	(select 
		country
		, minus
		, max_gr
	from 
		import19_bunc_minus
	) b on a.country=b.country
where a.country not in ('Cтраны Азии','Cтраны Африки','Cтраны Европы','в том числе страны ЕС:','СТРАНЫ ВНЕ СНГ','Америка,Карибский бассейн','Австралия и Океания','СНГ')	
order by country
---
create materialized view stat_customs.export19_bunc_minus as
select a.country,summa,total,total-summa minus,max_gr from 
(select 
	country
	--, sum(st_rub::numeric)
	, sum(st_doll_mln::numeric) summa
	, max(st_doll_mln::numeric) max_gr
from export_bunk_2019
where 
	code_name <> 'Итого'
group by country) a
join
(select 
	country
	--, sum(st_rub::numeric)
	, sum(st_doll_mln::numeric) total
from export_bunk_2019
where 
	code_name = 'Итого'
group by country) b
on a.country=b.country
order by minus desc
---
select distinct country from export_bunk_2019 order by country
--drop materialized view stat_customs._1_export19_bunc_added_sum
create materialized view stat_customs._1_export19_bunc_added_sum as
select 
	'2019' as year
	,a.country
	,code_6  as tnved
	,case when max_sum=max_gr then summa+minus else summa end as added_sum
from 
	(select 
		country
		, code_6 
		, sum(st_doll_mln::numeric) summa
		, max(st_doll_mln::numeric) max_sum
	from 
		export_bunk_2019
	where 
		code_name <> 'Итого'
	group by 
		country,code_6) a
	join
	(select 
		country
		, minus
		, max_gr
	from 
		export19_bunc_minus
	) b on a.country=b.country
where a.country not in ('СНГ','Cтраны Азии','Cтраны Африки','Cтраны Европы','в том числе страны ЕС:','СТРАНЫ ВНЕ СНГ','Америка,Карибский бассейн','Австралия и Океания','СНГ','Другие страны Европы')	
order by country
---
select year,country,tnved,added_sum from _1_import19_bunc_added_sum 
where country not in ('СНГ','Cтраны Азии','Cтраны Африки','Cтраны Европы','в том числе страны ЕС:','СТРАНЫ ВНЕ СНГ','Америка,Карибский бассейн','Австралия и Океания','СНГ','Другие страны Европы')	
---

select * from import19_bunc_minus
select year,country,sum(added_sum) from _1_import19_bunc_added_sum
group by year,country

--Сырьевые группы (sheet 3) ИМПОРТ bunc gr 19
create materialized view stat_customs._2_import19_bunc_gr as
select year, country, 'nn' gr, sum(added_sum) sum2019
from _1_import19_bunc_added_sum
where 
--nn
(left(tnved,2) in ('01',	'02',	'03',	'04',	'06',	'07',	'08',	'09',	'10',	'11',	'16',	'17',	'19',	'20',	'21',	'22',	'24',	'28',	'29',	'30',	'31',	'32',	'33',	'34',	'35',	'36',	'37',	'42',	'46',	'48',	'49',	'53',	'54',	'56',	'57',	'58',	'59',	'60',	'61',	'62',	'64',	'65',	'66',	'67',	'68',	'69',	'73',	'81',	'82',	'83',	'84',	'85',	'86',	'87',	'88',	'89',	'90',	'91',	'92',	'93',	'94',	'95',	'96',	'97')
or left(tnved,4) in ('0504',	'1201',	'1202',	'1203',	'1204',	'1205',	'1206',	'1207',	'1208',	'1209',	'1210',	'1212',	'1214',	'1302',	'1501',	'1502',	'1503',	'1504',	'1505',	'1506',	'1507',	'1508',	'1509',	'1510',	'1511',	'1512',	'1513',	'1514',	'1515',	'1516',	'1517',	'1518',	'1519',	'1520',	'1521',	'1801',	'1803',	'1804',	'1805',	'1806',	'2301',	'2304',	'2305',	'2306',	'2309',	'2523',	'3801',	'3802',	'3803',	'3805',	'3806',	'3807',	'3808',	'3809',	'3810',	'3811',	'3812',	'3813',	'3814',	'3815',	'3816',	'3817',	'3818',	'3819',	'3820',	'3821',	'3822',	'3823',	'3824',	'3826',	'3901',	'3902',	'3903',	'3904',	'3905',	'3906',	'3907',	'3908',	'3909',	'3910',	'3911',	'3912',	'3913',	'3914',	'3916',	'3917',	'3918',	'3919',	'3920',	'3921',	'3922',	'3923',	'3924',	'3925',	'3926',	'4002',	'4005',	'4006',	'4007',	'4008',	'4009',	'4010',	'4011',	'4012',	'4013',	'4014',	'4015',	'4016',	'4017',	'4104',	'4105',	'4106',	'4107',	'4108',	'4109',	'4110',	'4111',	'4112',	'4113',	'4114',	'4302',	'4303',	'4304',	'4402',	'4404',	'4405',	'4406',	'4407',	'4408',	'4409',	'4410',	'4411',	'4412',	'4413',	'4414',	'4415',	'4416',	'4417',	'4418',	'4419',	'4420',	'4421',	'4502',	'4503',	'4504',	'4701',	'4702',	'4703',	'4704',	'4705',	'4706',	'5004',	'5005',	'5006',	'5007',	'5105',	'5106',	'5107',	'5108',	'5109',	'5110',	'5111',	'5112',	'5113',	'5201',	'5203',	'5204',	'5205',	'5206',	'5207',	'5208',	'5209',	'5210',	'5211',	'5212',	'5501',	'5502',	'5503',	'5504',	'5506',	'5507',	'5508',	'5509',	'5510',	'5511',	'5512',	'5513',	'5514',	'5515',	'5516',	'6301',	'6302',	'6303',	'6304',	'6305',	'6306',	'6307',	'6308',	'6309',	'7002',	'7003',	'7004',	'7005',	'7006',	'7007',	'7008',	'7009',	'7010',	'7011',	'7012',	'7013',	'7014',	'7015',	'7016',	'7017',	'7018',	'7019',	'7020',	'7104',	'7105',	'7106',	'7107',	'7108',	'7109',	'7110',	'7111',	'7113',	'7114',	'7115',	'7116',	'7117',	'7118',	'7201',	'7202',	'7203',	'7205',	'7206',	'7207',	'7208',	'7209',	'7210',	'7211',	'7212',	'7213',	'7214',	'7215',	'7216',	'7217',	'7218',	'7219',	'7220',	'7221',	'7222',	'7223',	'7224',	'7225',	'7226',	'7227',	'7228',	'7229',	'7401',	'7402',	'7403',	'7405',	'7406',	'7407',	'7408',	'7409',	'7410',	'7411',	'7412',	'7413',	'7414',	'7415',	'7416',	'7417',	'7418',	'7419',	'7501',	'7502',	'7504',	'7505',	'7506',	'7507',	'7508',	'7601',	'7603',	'7604',	'7605',	'7606',	'7607',	'7608',	'7609',	'7610',	'7611',	'7612',	'7613',	'7614',	'7615',	'7616',	'7801',	'7804',	'7806',	'7901',	'7903',	'7904',	'7905',	'7906',	'7907',	'8001',	'8003',	'8007')
or left(tnved,6) in ('411510',	'710122',	'710229',	'710239',	'710391',	'710399'))
group by year, country--, tnved
union all
--s
select year, country, 's' "Группа", sum(added_sum) as "Сумма"
from _1_import19_bunc_added_sum
where 
(left(tnved,2) in ('14', '26')
or left(tnved,4) in ('0501',	'0502',	'0505',	'0506',	'0507',	'0508',	'0509',	'0510',	'0511',	'1211',	'1213',	'1301',	'1522',	'1802',	'2302',	'2303',	'2307',	'2308',	'2501',	'2502',	'2503',	'2504',	'2505',	'2506',	'2507',	'2508',	'2509',	'2510',	'2511',	'2512',	'2513',	'2514',	'2515',	'2516',	'2517',	'2518',	'2519',	'2520',	'2521',	'2522',	'2524',	'2525',	'2526',	'2527',	'2528',	'2529',	'2530',	'2701',	'2702',	'2703',	'2709',	'2714',	'3804',	'3825',	'3915',	'4001',	'4003',	'4004',	'4101',	'4102',	'4103',	'4301',	'4401',	'4403',	'4501',	'4707',	'5001',	'5002',	'5003',	'5101',	'5102',	'5103',	'5104',	'5202',	'5505',	'6310',	'7001',	'7112',	'7204',	'7404',	'7503',	'7602',	'7802',	'7902',	'8002')
or left(tnved,6) in ('271111',	'271121',	'411520',	'710110',	'710121',	'710210',	'710221',	'710231',	'710310'))
group by year, country--, tnved
union all
--ne
select year, country, 'ne' "Группа", sum(added_sum) as "Сумма"
from _1_import19_bunc_added_sum
where 
(left(tnved,4) in ('2704',	'2705',	'2706',	'2707',	'2708',	'2710',	'2712',	'2713',	'2715',	'2716')
or left(tnved,6) in ('271112',	'271113',	'271114',	'271115',	'271116',	'271117',	'271118',	'271119',	'271129'))
group by year, country
--
--Сырьевые группы (for sheet 3) ИМПОРТ bunc gr 18
create materialized view stat_customs._2_import18_bunc_gr as
select year, country, 'nn' gr, sum(added_sum) sum2018
from _1_import18_bunc_added_sum
where 
--nn
(left("﻿code_6",2) in ('01',	'02',	'03',	'04',	'06',	'07',	'08',	'09',	'10',	'11',	'16',	'17',	'19',	'20',	'21',	'22',	'24',	'28',	'29',	'30',	'31',	'32',	'33',	'34',	'35',	'36',	'37',	'42',	'46',	'48',	'49',	'53',	'54',	'56',	'57',	'58',	'59',	'60',	'61',	'62',	'64',	'65',	'66',	'67',	'68',	'69',	'73',	'81',	'82',	'83',	'84',	'85',	'86',	'87',	'88',	'89',	'90',	'91',	'92',	'93',	'94',	'95',	'96',	'97')
or left("﻿code_6",4) in ('0504',	'1201',	'1202',	'1203',	'1204',	'1205',	'1206',	'1207',	'1208',	'1209',	'1210',	'1212',	'1214',	'1302',	'1501',	'1502',	'1503',	'1504',	'1505',	'1506',	'1507',	'1508',	'1509',	'1510',	'1511',	'1512',	'1513',	'1514',	'1515',	'1516',	'1517',	'1518',	'1519',	'1520',	'1521',	'1801',	'1803',	'1804',	'1805',	'1806',	'2301',	'2304',	'2305',	'2306',	'2309',	'2523',	'3801',	'3802',	'3803',	'3805',	'3806',	'3807',	'3808',	'3809',	'3810',	'3811',	'3812',	'3813',	'3814',	'3815',	'3816',	'3817',	'3818',	'3819',	'3820',	'3821',	'3822',	'3823',	'3824',	'3826',	'3901',	'3902',	'3903',	'3904',	'3905',	'3906',	'3907',	'3908',	'3909',	'3910',	'3911',	'3912',	'3913',	'3914',	'3916',	'3917',	'3918',	'3919',	'3920',	'3921',	'3922',	'3923',	'3924',	'3925',	'3926',	'4002',	'4005',	'4006',	'4007',	'4008',	'4009',	'4010',	'4011',	'4012',	'4013',	'4014',	'4015',	'4016',	'4017',	'4104',	'4105',	'4106',	'4107',	'4108',	'4109',	'4110',	'4111',	'4112',	'4113',	'4114',	'4302',	'4303',	'4304',	'4402',	'4404',	'4405',	'4406',	'4407',	'4408',	'4409',	'4410',	'4411',	'4412',	'4413',	'4414',	'4415',	'4416',	'4417',	'4418',	'4419',	'4420',	'4421',	'4502',	'4503',	'4504',	'4701',	'4702',	'4703',	'4704',	'4705',	'4706',	'5004',	'5005',	'5006',	'5007',	'5105',	'5106',	'5107',	'5108',	'5109',	'5110',	'5111',	'5112',	'5113',	'5201',	'5203',	'5204',	'5205',	'5206',	'5207',	'5208',	'5209',	'5210',	'5211',	'5212',	'5501',	'5502',	'5503',	'5504',	'5506',	'5507',	'5508',	'5509',	'5510',	'5511',	'5512',	'5513',	'5514',	'5515',	'5516',	'6301',	'6302',	'6303',	'6304',	'6305',	'6306',	'6307',	'6308',	'6309',	'7002',	'7003',	'7004',	'7005',	'7006',	'7007',	'7008',	'7009',	'7010',	'7011',	'7012',	'7013',	'7014',	'7015',	'7016',	'7017',	'7018',	'7019',	'7020',	'7104',	'7105',	'7106',	'7107',	'7108',	'7109',	'7110',	'7111',	'7113',	'7114',	'7115',	'7116',	'7117',	'7118',	'7201',	'7202',	'7203',	'7205',	'7206',	'7207',	'7208',	'7209',	'7210',	'7211',	'7212',	'7213',	'7214',	'7215',	'7216',	'7217',	'7218',	'7219',	'7220',	'7221',	'7222',	'7223',	'7224',	'7225',	'7226',	'7227',	'7228',	'7229',	'7401',	'7402',	'7403',	'7405',	'7406',	'7407',	'7408',	'7409',	'7410',	'7411',	'7412',	'7413',	'7414',	'7415',	'7416',	'7417',	'7418',	'7419',	'7501',	'7502',	'7504',	'7505',	'7506',	'7507',	'7508',	'7601',	'7603',	'7604',	'7605',	'7606',	'7607',	'7608',	'7609',	'7610',	'7611',	'7612',	'7613',	'7614',	'7615',	'7616',	'7801',	'7804',	'7806',	'7901',	'7903',	'7904',	'7905',	'7906',	'7907',	'8001',	'8003',	'8007')
or left("﻿code_6",6) in ('411510',	'710122',	'710229',	'710239',	'710391',	'710399'))
group by year, country--, tnved
union all
--s
select year, country, 's' "Группа", sum(added_sum) as "Сумма"
from _1_import18_bunc_added_sum
where 
(left("﻿code_6",2) in ('14', '26')
or left("﻿code_6",4) in ('0501',	'0502',	'0505',	'0506',	'0507',	'0508',	'0509',	'0510',	'0511',	'1211',	'1213',	'1301',	'1522',	'1802',	'2302',	'2303',	'2307',	'2308',	'2501',	'2502',	'2503',	'2504',	'2505',	'2506',	'2507',	'2508',	'2509',	'2510',	'2511',	'2512',	'2513',	'2514',	'2515',	'2516',	'2517',	'2518',	'2519',	'2520',	'2521',	'2522',	'2524',	'2525',	'2526',	'2527',	'2528',	'2529',	'2530',	'2701',	'2702',	'2703',	'2709',	'2714',	'3804',	'3825',	'3915',	'4001',	'4003',	'4004',	'4101',	'4102',	'4103',	'4301',	'4401',	'4403',	'4501',	'4707',	'5001',	'5002',	'5003',	'5101',	'5102',	'5103',	'5104',	'5202',	'5505',	'6310',	'7001',	'7112',	'7204',	'7404',	'7503',	'7602',	'7802',	'7902',	'8002')
or left("﻿code_6",6) in ('271111',	'271121',	'411520',	'710110',	'710121',	'710210',	'710221',	'710231',	'710310'))
group by year, country--, tnved
union all
--ne
select year, country, 'ne' "Группа", sum(added_sum) as "Сумма"
from _1_import18_bunc_added_sum
where 
(left("﻿code_6",4) in ('2704',	'2705',	'2706',	'2707',	'2708',	'2710',	'2712',	'2713',	'2715',	'2716')
or left("﻿code_6",6) in ('271112',	'271113',	'271114',	'271115',	'271116',	'271117',	'271118',	'271119',	'271129'))
group by year, country

--
--Сырьевые группы (sheet 3) ЭКСПОРТ bunc gr
drop materialized view stat_customs._2_export19_bunc_gr
create materialized view stat_customs._2_export19_bunc_gr as
select year, country, 'nn' gr, sum(added_sum) sum2019
from _1_export19_bunc_added_sum
where 
--nn
(left(tnved,2) in ('01',	'02',	'03',	'04',	'06',	'07',	'08',	'09',	'10',	'11',	'16',	'17',	'19',	'20',	'21',	'22',	'24',	'28',	'29',	'30',	'31',	'32',	'33',	'34',	'35',	'36',	'37',	'42',	'46',	'48',	'49',	'53',	'54',	'56',	'57',	'58',	'59',	'60',	'61',	'62',	'64',	'65',	'66',	'67',	'68',	'69',	'73',	'81',	'82',	'83',	'84',	'85',	'86',	'87',	'88',	'89',	'90',	'91',	'92',	'93',	'94',	'95',	'96',	'97')
or left(tnved,4) in ('0504',	'1201',	'1202',	'1203',	'1204',	'1205',	'1206',	'1207',	'1208',	'1209',	'1210',	'1212',	'1214',	'1302',	'1501',	'1502',	'1503',	'1504',	'1505',	'1506',	'1507',	'1508',	'1509',	'1510',	'1511',	'1512',	'1513',	'1514',	'1515',	'1516',	'1517',	'1518',	'1519',	'1520',	'1521',	'1801',	'1803',	'1804',	'1805',	'1806',	'2301',	'2304',	'2305',	'2306',	'2309',	'2523',	'3801',	'3802',	'3803',	'3805',	'3806',	'3807',	'3808',	'3809',	'3810',	'3811',	'3812',	'3813',	'3814',	'3815',	'3816',	'3817',	'3818',	'3819',	'3820',	'3821',	'3822',	'3823',	'3824',	'3826',	'3901',	'3902',	'3903',	'3904',	'3905',	'3906',	'3907',	'3908',	'3909',	'3910',	'3911',	'3912',	'3913',	'3914',	'3916',	'3917',	'3918',	'3919',	'3920',	'3921',	'3922',	'3923',	'3924',	'3925',	'3926',	'4002',	'4005',	'4006',	'4007',	'4008',	'4009',	'4010',	'4011',	'4012',	'4013',	'4014',	'4015',	'4016',	'4017',	'4104',	'4105',	'4106',	'4107',	'4108',	'4109',	'4110',	'4111',	'4112',	'4113',	'4114',	'4302',	'4303',	'4304',	'4402',	'4404',	'4405',	'4406',	'4407',	'4408',	'4409',	'4410',	'4411',	'4412',	'4413',	'4414',	'4415',	'4416',	'4417',	'4418',	'4419',	'4420',	'4421',	'4502',	'4503',	'4504',	'4701',	'4702',	'4703',	'4704',	'4705',	'4706',	'5004',	'5005',	'5006',	'5007',	'5105',	'5106',	'5107',	'5108',	'5109',	'5110',	'5111',	'5112',	'5113',	'5201',	'5203',	'5204',	'5205',	'5206',	'5207',	'5208',	'5209',	'5210',	'5211',	'5212',	'5501',	'5502',	'5503',	'5504',	'5506',	'5507',	'5508',	'5509',	'5510',	'5511',	'5512',	'5513',	'5514',	'5515',	'5516',	'6301',	'6302',	'6303',	'6304',	'6305',	'6306',	'6307',	'6308',	'6309',	'7002',	'7003',	'7004',	'7005',	'7006',	'7007',	'7008',	'7009',	'7010',	'7011',	'7012',	'7013',	'7014',	'7015',	'7016',	'7017',	'7018',	'7019',	'7020',	'7104',	'7105',	'7106',	'7107',	'7108',	'7109',	'7110',	'7111',	'7113',	'7114',	'7115',	'7116',	'7117',	'7118',	'7201',	'7202',	'7203',	'7205',	'7206',	'7207',	'7208',	'7209',	'7210',	'7211',	'7212',	'7213',	'7214',	'7215',	'7216',	'7217',	'7218',	'7219',	'7220',	'7221',	'7222',	'7223',	'7224',	'7225',	'7226',	'7227',	'7228',	'7229',	'7401',	'7402',	'7403',	'7405',	'7406',	'7407',	'7408',	'7409',	'7410',	'7411',	'7412',	'7413',	'7414',	'7415',	'7416',	'7417',	'7418',	'7419',	'7501',	'7502',	'7504',	'7505',	'7506',	'7507',	'7508',	'7601',	'7603',	'7604',	'7605',	'7606',	'7607',	'7608',	'7609',	'7610',	'7611',	'7612',	'7613',	'7614',	'7615',	'7616',	'7801',	'7804',	'7806',	'7901',	'7903',	'7904',	'7905',	'7906',	'7907',	'8001',	'8003',	'8007')
or left(tnved,6) in ('411510',	'710122',	'710229',	'710239',	'710391',	'710399'))
group by year, country--, tnved
union all
--s
select year, country, 's' "Группа", sum(added_sum) as "Сумма"
from _1_export19_bunc_added_sum
where 
(left(tnved,2) in ('14', '26')
or left(tnved,4) in ('0501',	'0502',	'0505',	'0506',	'0507',	'0508',	'0509',	'0510',	'0511',	'1211',	'1213',	'1301',	'1522',	'1802',	'2302',	'2303',	'2307',	'2308',	'2501',	'2502',	'2503',	'2504',	'2505',	'2506',	'2507',	'2508',	'2509',	'2510',	'2511',	'2512',	'2513',	'2514',	'2515',	'2516',	'2517',	'2518',	'2519',	'2520',	'2521',	'2522',	'2524',	'2525',	'2526',	'2527',	'2528',	'2529',	'2530',	'2701',	'2702',	'2703',	'2709',	'2714',	'3804',	'3825',	'3915',	'4001',	'4003',	'4004',	'4101',	'4102',	'4103',	'4301',	'4401',	'4403',	'4501',	'4707',	'5001',	'5002',	'5003',	'5101',	'5102',	'5103',	'5104',	'5202',	'5505',	'6310',	'7001',	'7112',	'7204',	'7404',	'7503',	'7602',	'7802',	'7902',	'8002')
or left(tnved,6) in ('271111',	'271121',	'411520',	'710110',	'710121',	'710210',	'710221',	'710231',	'710310'))
group by year, country--, tnved
union all
--ne
select year, country, 'ne' "Группа", sum(added_sum) as "Сумма"
from _1_export19_bunc_added_sum
where 
(left(tnved,4) in ('2704',	'2705',	'2706',	'2707',	'2708',	'2710',	'2712',	'2713',	'2715',	'2716')
or left(tnved,6) in ('271112',	'271113',	'271114',	'271115',	'271116',	'271117',	'271118',	'271119',	'271129'))
group by year, country

--fish gr 19
create materialized view stat_customs._2_export19_fish_gr as
select year, country, 'nn' gr, sum(added_sum) sum2019
from _1_export19_fish_added_sum
where 
--nn
(left(code_6,2) in ('01',	'02',	'03',	'04',	'06',	'07',	'08',	'09',	'10',	'11',	'16',	'17',	'19',	'20',	'21',	'22',	'24',	'28',	'29',	'30',	'31',	'32',	'33',	'34',	'35',	'36',	'37',	'42',	'46',	'48',	'49',	'53',	'54',	'56',	'57',	'58',	'59',	'60',	'61',	'62',	'64',	'65',	'66',	'67',	'68',	'69',	'73',	'81',	'82',	'83',	'84',	'85',	'86',	'87',	'88',	'89',	'90',	'91',	'92',	'93',	'94',	'95',	'96',	'97')
or left(code_6,4) in ('0504',	'1201',	'1202',	'1203',	'1204',	'1205',	'1206',	'1207',	'1208',	'1209',	'1210',	'1212',	'1214',	'1302',	'1501',	'1502',	'1503',	'1504',	'1505',	'1506',	'1507',	'1508',	'1509',	'1510',	'1511',	'1512',	'1513',	'1514',	'1515',	'1516',	'1517',	'1518',	'1519',	'1520',	'1521',	'1801',	'1803',	'1804',	'1805',	'1806',	'2301',	'2304',	'2305',	'2306',	'2309',	'2523',	'3801',	'3802',	'3803',	'3805',	'3806',	'3807',	'3808',	'3809',	'3810',	'3811',	'3812',	'3813',	'3814',	'3815',	'3816',	'3817',	'3818',	'3819',	'3820',	'3821',	'3822',	'3823',	'3824',	'3826',	'3901',	'3902',	'3903',	'3904',	'3905',	'3906',	'3907',	'3908',	'3909',	'3910',	'3911',	'3912',	'3913',	'3914',	'3916',	'3917',	'3918',	'3919',	'3920',	'3921',	'3922',	'3923',	'3924',	'3925',	'3926',	'4002',	'4005',	'4006',	'4007',	'4008',	'4009',	'4010',	'4011',	'4012',	'4013',	'4014',	'4015',	'4016',	'4017',	'4104',	'4105',	'4106',	'4107',	'4108',	'4109',	'4110',	'4111',	'4112',	'4113',	'4114',	'4302',	'4303',	'4304',	'4402',	'4404',	'4405',	'4406',	'4407',	'4408',	'4409',	'4410',	'4411',	'4412',	'4413',	'4414',	'4415',	'4416',	'4417',	'4418',	'4419',	'4420',	'4421',	'4502',	'4503',	'4504',	'4701',	'4702',	'4703',	'4704',	'4705',	'4706',	'5004',	'5005',	'5006',	'5007',	'5105',	'5106',	'5107',	'5108',	'5109',	'5110',	'5111',	'5112',	'5113',	'5201',	'5203',	'5204',	'5205',	'5206',	'5207',	'5208',	'5209',	'5210',	'5211',	'5212',	'5501',	'5502',	'5503',	'5504',	'5506',	'5507',	'5508',	'5509',	'5510',	'5511',	'5512',	'5513',	'5514',	'5515',	'5516',	'6301',	'6302',	'6303',	'6304',	'6305',	'6306',	'6307',	'6308',	'6309',	'7002',	'7003',	'7004',	'7005',	'7006',	'7007',	'7008',	'7009',	'7010',	'7011',	'7012',	'7013',	'7014',	'7015',	'7016',	'7017',	'7018',	'7019',	'7020',	'7104',	'7105',	'7106',	'7107',	'7108',	'7109',	'7110',	'7111',	'7113',	'7114',	'7115',	'7116',	'7117',	'7118',	'7201',	'7202',	'7203',	'7205',	'7206',	'7207',	'7208',	'7209',	'7210',	'7211',	'7212',	'7213',	'7214',	'7215',	'7216',	'7217',	'7218',	'7219',	'7220',	'7221',	'7222',	'7223',	'7224',	'7225',	'7226',	'7227',	'7228',	'7229',	'7401',	'7402',	'7403',	'7405',	'7406',	'7407',	'7408',	'7409',	'7410',	'7411',	'7412',	'7413',	'7414',	'7415',	'7416',	'7417',	'7418',	'7419',	'7501',	'7502',	'7504',	'7505',	'7506',	'7507',	'7508',	'7601',	'7603',	'7604',	'7605',	'7606',	'7607',	'7608',	'7609',	'7610',	'7611',	'7612',	'7613',	'7614',	'7615',	'7616',	'7801',	'7804',	'7806',	'7901',	'7903',	'7904',	'7905',	'7906',	'7907',	'8001',	'8003',	'8007')
or left(code_6,6) in ('411510',	'710122',	'710229',	'710239',	'710391',	'710399'))
group by year, country--, tnved
union all
--s
select year, country, 's' "Группа", sum(added_sum) as "Сумма"
from _1_export19_fish_added_sum
where 
(left(code_6,2) in ('14', '26')
or left(code_6,4) in ('0501',	'0502',	'0505',	'0506',	'0507',	'0508',	'0509',	'0510',	'0511',	'1211',	'1213',	'1301',	'1522',	'1802',	'2302',	'2303',	'2307',	'2308',	'2501',	'2502',	'2503',	'2504',	'2505',	'2506',	'2507',	'2508',	'2509',	'2510',	'2511',	'2512',	'2513',	'2514',	'2515',	'2516',	'2517',	'2518',	'2519',	'2520',	'2521',	'2522',	'2524',	'2525',	'2526',	'2527',	'2528',	'2529',	'2530',	'2701',	'2702',	'2703',	'2709',	'2714',	'3804',	'3825',	'3915',	'4001',	'4003',	'4004',	'4101',	'4102',	'4103',	'4301',	'4401',	'4403',	'4501',	'4707',	'5001',	'5002',	'5003',	'5101',	'5102',	'5103',	'5104',	'5202',	'5505',	'6310',	'7001',	'7112',	'7204',	'7404',	'7503',	'7602',	'7802',	'7902',	'8002')
or left(code_6,6) in ('271111',	'271121',	'411520',	'710110',	'710121',	'710210',	'710221',	'710231',	'710310'))
group by year, country--, tnved
union all
--ne
select year, country, 'ne' "Группа", sum(added_sum) as "Сумма"
from _1_export19_fish_added_sum
where 
(left(code_6,4) in ('2704',	'2705',	'2706',	'2707',	'2708',	'2710',	'2712',	'2713',	'2715',	'2716')
or left(code_6,6) in ('271112',	'271113',	'271114',	'271115',	'271116',	'271117',	'271118',	'271119',	'271129'))
group by year, country
--
--fish gr 18
create materialized view stat_customs._2_export18_fish_gr as
select year, country, 'nn' gr, sum(added_sum) sum2018
from _1_export18_fish_added_sum
where 
--nn
(left(code_6,2) in ('01',	'02',	'03',	'04',	'06',	'07',	'08',	'09',	'10',	'11',	'16',	'17',	'19',	'20',	'21',	'22',	'24',	'28',	'29',	'30',	'31',	'32',	'33',	'34',	'35',	'36',	'37',	'42',	'46',	'48',	'49',	'53',	'54',	'56',	'57',	'58',	'59',	'60',	'61',	'62',	'64',	'65',	'66',	'67',	'68',	'69',	'73',	'81',	'82',	'83',	'84',	'85',	'86',	'87',	'88',	'89',	'90',	'91',	'92',	'93',	'94',	'95',	'96',	'97')
or left(code_6,4) in ('0504',	'1201',	'1202',	'1203',	'1204',	'1205',	'1206',	'1207',	'1208',	'1209',	'1210',	'1212',	'1214',	'1302',	'1501',	'1502',	'1503',	'1504',	'1505',	'1506',	'1507',	'1508',	'1509',	'1510',	'1511',	'1512',	'1513',	'1514',	'1515',	'1516',	'1517',	'1518',	'1519',	'1520',	'1521',	'1801',	'1803',	'1804',	'1805',	'1806',	'2301',	'2304',	'2305',	'2306',	'2309',	'2523',	'3801',	'3802',	'3803',	'3805',	'3806',	'3807',	'3808',	'3809',	'3810',	'3811',	'3812',	'3813',	'3814',	'3815',	'3816',	'3817',	'3818',	'3819',	'3820',	'3821',	'3822',	'3823',	'3824',	'3826',	'3901',	'3902',	'3903',	'3904',	'3905',	'3906',	'3907',	'3908',	'3909',	'3910',	'3911',	'3912',	'3913',	'3914',	'3916',	'3917',	'3918',	'3919',	'3920',	'3921',	'3922',	'3923',	'3924',	'3925',	'3926',	'4002',	'4005',	'4006',	'4007',	'4008',	'4009',	'4010',	'4011',	'4012',	'4013',	'4014',	'4015',	'4016',	'4017',	'4104',	'4105',	'4106',	'4107',	'4108',	'4109',	'4110',	'4111',	'4112',	'4113',	'4114',	'4302',	'4303',	'4304',	'4402',	'4404',	'4405',	'4406',	'4407',	'4408',	'4409',	'4410',	'4411',	'4412',	'4413',	'4414',	'4415',	'4416',	'4417',	'4418',	'4419',	'4420',	'4421',	'4502',	'4503',	'4504',	'4701',	'4702',	'4703',	'4704',	'4705',	'4706',	'5004',	'5005',	'5006',	'5007',	'5105',	'5106',	'5107',	'5108',	'5109',	'5110',	'5111',	'5112',	'5113',	'5201',	'5203',	'5204',	'5205',	'5206',	'5207',	'5208',	'5209',	'5210',	'5211',	'5212',	'5501',	'5502',	'5503',	'5504',	'5506',	'5507',	'5508',	'5509',	'5510',	'5511',	'5512',	'5513',	'5514',	'5515',	'5516',	'6301',	'6302',	'6303',	'6304',	'6305',	'6306',	'6307',	'6308',	'6309',	'7002',	'7003',	'7004',	'7005',	'7006',	'7007',	'7008',	'7009',	'7010',	'7011',	'7012',	'7013',	'7014',	'7015',	'7016',	'7017',	'7018',	'7019',	'7020',	'7104',	'7105',	'7106',	'7107',	'7108',	'7109',	'7110',	'7111',	'7113',	'7114',	'7115',	'7116',	'7117',	'7118',	'7201',	'7202',	'7203',	'7205',	'7206',	'7207',	'7208',	'7209',	'7210',	'7211',	'7212',	'7213',	'7214',	'7215',	'7216',	'7217',	'7218',	'7219',	'7220',	'7221',	'7222',	'7223',	'7224',	'7225',	'7226',	'7227',	'7228',	'7229',	'7401',	'7402',	'7403',	'7405',	'7406',	'7407',	'7408',	'7409',	'7410',	'7411',	'7412',	'7413',	'7414',	'7415',	'7416',	'7417',	'7418',	'7419',	'7501',	'7502',	'7504',	'7505',	'7506',	'7507',	'7508',	'7601',	'7603',	'7604',	'7605',	'7606',	'7607',	'7608',	'7609',	'7610',	'7611',	'7612',	'7613',	'7614',	'7615',	'7616',	'7801',	'7804',	'7806',	'7901',	'7903',	'7904',	'7905',	'7906',	'7907',	'8001',	'8003',	'8007')
or left(code_6,6) in ('411510',	'710122',	'710229',	'710239',	'710391',	'710399'))
group by year, country--, tnved
union all
--s
select year, country, 's' "Группа", sum(added_sum) as "Сумма"
from _1_export18_fish_added_sum
where 
(left(code_6,2) in ('14', '26')
or left(code_6,4) in ('0501',	'0502',	'0505',	'0506',	'0507',	'0508',	'0509',	'0510',	'0511',	'1211',	'1213',	'1301',	'1522',	'1802',	'2302',	'2303',	'2307',	'2308',	'2501',	'2502',	'2503',	'2504',	'2505',	'2506',	'2507',	'2508',	'2509',	'2510',	'2511',	'2512',	'2513',	'2514',	'2515',	'2516',	'2517',	'2518',	'2519',	'2520',	'2521',	'2522',	'2524',	'2525',	'2526',	'2527',	'2528',	'2529',	'2530',	'2701',	'2702',	'2703',	'2709',	'2714',	'3804',	'3825',	'3915',	'4001',	'4003',	'4004',	'4101',	'4102',	'4103',	'4301',	'4401',	'4403',	'4501',	'4707',	'5001',	'5002',	'5003',	'5101',	'5102',	'5103',	'5104',	'5202',	'5505',	'6310',	'7001',	'7112',	'7204',	'7404',	'7503',	'7602',	'7802',	'7902',	'8002')
or left(code_6,6) in ('271111',	'271121',	'411520',	'710110',	'710121',	'710210',	'710221',	'710231',	'710310'))
group by year, country--, tnved
union all
--ne
select year, country, 'ne' "Группа", sum(added_sum) as "Сумма"
from _1_export18_fish_added_sum
where 
(left(code_6,4) in ('2704',	'2705',	'2706',	'2707',	'2708',	'2710',	'2712',	'2713',	'2715',	'2716')
or left(code_6,6) in ('271112',	'271113',	'271114',	'271115',	'271116',	'271117',	'271118',	'271119',	'271129'))
group by year, country


--
select 
	case 
			when country in ('АЗЕРБАЙДЖАН', 'АРМЕНИЯ', 'БЕЛАРУСЬ', 'КАЗАХСТАН', 'КИРГИЗИЯ', 'МОЛДОВА, РЕСПУБЛИКА', 'ТАДЖИКИСТАН', 'ТУРКМЕНИЯ', 'УЗБЕКИСТАН', 'УКРАИНА') then 'СНГ'
			when country in ('АВСТРАЛИЯ','АВСТРИЯ','БЕЛЬГИЯ',	'СОЕДИНЕННОЕ КОРОЛЕВСТВО','ВЕНГРИЯ',	'ГЕРМАНИЯ',	'ГРЕЦИЯ','ДАНИЯ',	'ИЗРАИЛЬ',	'ИРЛАНДИЯ',	'ИСЛАНДИЯ',	'ИСПАНИЯ','ИТАЛИЯ','КАНАДА','ЛАТВИЯ','ЛЮКСЕМБУРГ','МЕКСИКА','НИДЕРЛАНДЫ','НОВАЯ ЗЕЛАНДИЯ',	'НОРВЕГИЯ',	'ПОЛЬША','ПОРТУГАЛИЯ','КОРЕЯ, РЕСПУБЛИКА','СЛОВАКИЯ',	'СЛОВЕНИЯ',	'СОЕДИНЕННЫЕ ШТАТЫ','ТУРЦИЯ','ФИНЛЯНДИЯ','ФРАНЦИЯ','ЧЕХИЯ','ЧИЛИ','ШВЕЙЦАРИЯ','ШВЕЦИЯ','ЭСТОНИЯ','ЯПОНИЯ') then 'ОЭСР'
	   else 'Другие'
	end "Группа стран",
	country
	, gr
	, sum(case when year='2019' then sum2019 end) "2019"
from _2_export19_bunc_gr
group by country, gr
--union
--	select 
--		'Всего'
--		,'Всего'
--		,gr
--		,sum(sum2019)
--	from _2_import19_bunc_gr
--group by gr
order by country, gr

---IMPORT
with list_2_import as (
select 
	case 
			when country in ('АЗЕРБАЙДЖАН', 'АРМЕНИЯ', 'БЕЛАРУСЬ', 'КАЗАХСТАН', 'КИРГИЗИЯ', 'МОЛДОВА, РЕСПУБЛИКА', 'ТАДЖИКИСТАН', 'ТУРКМЕНИЯ', 'УЗБЕКИСТАН', 'УКРАИНА') then 'СНГ'
			when country in ('АВСТРАЛИЯ','АВСТРИЯ','БЕЛЬГИЯ',	'СОЕДИНЕННОЕ КОРОЛЕВСТВО','ВЕНГРИЯ',	'ГЕРМАНИЯ',	'ГРЕЦИЯ','ДАНИЯ',	'ИЗРАИЛЬ',	'ИРЛАНДИЯ',	'ИСЛАНДИЯ',	'ИСПАНИЯ','ИТАЛИЯ','КАНАДА','ЛАТВИЯ','ЛЮКСЕМБУРГ','МЕКСИКА','НИДЕРЛАНДЫ','НОВАЯ ЗЕЛАНДИЯ',	'НОРВЕГИЯ',	'ПОЛЬША','ПОРТУГАЛИЯ','КОРЕЯ, РЕСПУБЛИКА','СЛОВАКИЯ',	'СЛОВЕНИЯ',	'СОЕДИНЕННЫЕ ШТАТЫ','ТУРЦИЯ','ФИНЛЯНДИЯ','ФРАНЦИЯ','ЧЕХИЯ','ЧИЛИ','ШВЕЙЦАРИЯ','ШВЕЦИЯ','ЭСТОНИЯ','ЯПОНИЯ') then 'ОЭСР'
	   else 'Другие'
	end "Группа стран"
	,country
	, gr
	, sum(case when year='2019' then sum2019 end) "2019"
from _2_import19_bunc_gr
group by country, gr
)
select 
	"Группа стран"
	,gr
	,sum("2019")
from list_2_import
where country not in ('Всего по странам мира')
group by 
	"Группа стран",gr
order by "Группа стран",gr

--EXPORT fish
with list_2_export as (
select 
	case 
			when country in ('АЗЕРБАЙДЖАН', 'АРМЕНИЯ', 'БЕЛАРУСЬ', 'КАЗАХСТАН', 'КИРГИЗИЯ', 'МОЛДОВА, РЕСПУБЛИКА', 'ТАДЖИКИСТАН', 'ТУРКМЕНИЯ', 'УЗБЕКИСТАН', 'УКРАИНА') then 'СНГ'
			when country in ('АВСТРАЛИЯ','АВСТРИЯ','БЕЛЬГИЯ',	'СОЕДИНЕННОЕ КОРОЛЕВСТВО','ВЕНГРИЯ',	'ГЕРМАНИЯ',	'ГРЕЦИЯ','ДАНИЯ',	'ИЗРАИЛЬ',	'ИРЛАНДИЯ',	'ИСЛАНДИЯ',	'ИСПАНИЯ','ИТАЛИЯ','КАНАДА','ЛАТВИЯ','ЛЮКСЕМБУРГ','МЕКСИКА','НИДЕРЛАНДЫ','НОВАЯ ЗЕЛАНДИЯ',	'НОРВЕГИЯ',	'ПОЛЬША','ПОРТУГАЛИЯ','КОРЕЯ, РЕСПУБЛИКА','СЛОВАКИЯ',	'СЛОВЕНИЯ',	'СОЕДИНЕННЫЕ ШТАТЫ','ТУРЦИЯ','ФИНЛЯНДИЯ','ФРАНЦИЯ','ЧЕХИЯ','ЧИЛИ','ШВЕЙЦАРИЯ','ШВЕЦИЯ','ЭСТОНИЯ','ЯПОНИЯ') then 'ОЭСР'
	   else 'Другие'
	end "Группа стран"
	,country
	, gr
	, sum(case when year='2019' then sum2019 end) "2019"
from _2_export19_bunc_gr
group by country, gr
)
select 
	"Группа стран"
	,gr
	,sum("2019")
from list_2_export
where country not in ('Всего по странам мира')
group by 
	"Группа стран",gr
union 
select 
	'Всего'
	,gr
	,sum("2019")
from list_2_export
where country not in ('Всего по странам мира')
group by 
	gr
order by "Группа стран",gr	


